<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/redux@4.1.0/dist/redux.min.js"></script>
    <script src="https://unpkg.com/react-redux@8.0.0/dist/react-redux.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone"></script>
    <title>Shopping Cart (Redux)</title>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      // 1Ô∏è‚É£ ACTION TYPES
      const ADD_TO_CART = "ADD_TO_CART";
      const REMOVE_FROM_CART = "REMOVE_FROM_CART";

      // 2Ô∏è‚É£ ACTION CREATORS
      const addToCart = (product) => ({
        type: ADD_TO_CART,
        payload: product,
      });

      const removeFromCart = (id) => ({
        type: REMOVE_FROM_CART,
        payload: id,
      });

      // 3Ô∏è‚É£ INITIAL STATE
      const initialState = {
        cart: [],
      };

      // 4Ô∏è‚É£ REDUCER FUNCTION
      const cartReducer = (state = initialState, action) => {
        switch (action.type) {
          case ADD_TO_CART: {
            const existingItem = state.cart.find(
              (item) => item.id === action.payload.id
            );
            if (existingItem) {
              return {
                ...state,
                cart: state.cart.map((item) =>
                  item.id === action.payload.id
                    ? { ...item, quantity: item.quantity + 1 }
                    : item
                ),
              };
            }
            return {
              ...state,
              cart: [...state.cart, { ...action.payload, quantity: 1 }],
            };
          }

          case REMOVE_FROM_CART: {
            const existingItem = state.cart.find(
              (item) => item.id === action.payload
            );
            if (existingItem.quantity > 1) {
              return {
                ...state,
                cart: state.cart.map((item) =>
                  item.id === action.payload
                    ? { ...item, quantity: item.quantity - 1 }
                    : item
                ),
              };
            }
            return {
              ...state,
              cart: state.cart.filter((item) => item.id !== action.payload),
            };
          }

          default:
            return state;
        }
      };

      // 5Ô∏è‚É£ CREATE STORE
      const store = Redux.createStore(cartReducer);

      // 6Ô∏è‚É£ SHOPPING CART COMPONENT
      const Cart = () => {
        const cart = ReactRedux.useSelector((state) => state.cart);
        const dispatch = ReactRedux.useDispatch();

        const products = [
          { id: 1, name: "Apple", price: 10 },
          { id: 2, name: "Banana", price: 5 },
          { id: 3, name: "Orange", price: 8 },
        ];

        return (
          <div style={{ padding: "20px", fontFamily: "Arial, sans-serif" }}>
            <h1>üõí Shopping Cart (Redux)</h1>

            {/* Product List */}
            <h2>Products:</h2>
            <ul>
              {products.map((product) => (
                <li key={product.id}>
                  {product.name} - ${product.price}
                  <button
                    onClick={() => dispatch(addToCart(product))}
                    style={{
                      marginLeft: "10px",
                      padding: "5px",
                      cursor: "pointer",
                    }}
                  >
                    Add to Cart
                  </button>
                </li>
              ))}
            </ul>

            {/* Cart Items */}
            <h2>
              Cart ({cart.reduce((acc, item) => acc + item.quantity, 0)} items):
            </h2>
            <ul>
              {cart.map((item) => (
                <li key={item.id}>
                  {item.name} - ${item.price} x {item.quantity} = $
                  {item.price * item.quantity}
                  <button
                    onClick={() => dispatch(removeFromCart(item.id))}
                    style={{
                      marginLeft: "10px",
                      padding: "5px",
                      cursor: "pointer",
                    }}
                  >
                    -
                  </button>
                  <button
                    onClick={() => dispatch(addToCart(item))}
                    style={{
                      marginLeft: "5px",
                      padding: "5px",
                      cursor: "pointer",
                    }}
                  >
                    +
                  </button>
                </li>
              ))}
            </ul>
          </div>
        );
      };

      // 7Ô∏è‚É£ PROVIDER WRAPPER
      const { Provider } = ReactRedux;
      ReactDOM.render(
        <Provider store={store}>
          <Cart />
        </Provider>,
        document.getElementById("root")
      );
    </script>
  </body>
</html>
